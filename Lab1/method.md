
计算噪声时保留正负号 (noise = frame - denoised)，以确保噪声均值接近于0。
使用这个原始噪声数据来计算标准差，这样才能准确衡量噪声的波动幅度。
仅在可视化时，才对噪声取绝对值，以方便观察。

这个函数的主要工作流程如下：

数据提取：

自动遍历 denoised_results 文件夹下的所有子文件夹。
加载每个参数组合的 average_noise_matrix.npy 文件。
计算每个噪声矩阵的标准差 (Standard Deviation)，并将其作为该参数组合下噪声水平的量化指标。
噪声 vs. 曝光 (Exposure) 建模：

筛选出增益 (Gain) 固定（默认为 5.0）的所有数据点。
使用 scipy.optimize.curve_fit 函数，尝试用一个二次函数 (Quadratic Model) y = ax² + bx + c 来拟合噪声标准差 (y) 与曝光 (x) 之间的关系。
计算R² (决定系数)，这是一个评估模型拟合优度的指标，值越接近 1，表示模型对数据的解释能力越强。
生成一张图表，将实际数据点和拟合的二次曲线绘制在一起，并附上拟合的函数方程和 R² 值。
噪声 vs. 增益 (Gain) 建模：

筛选出曝光 (Exposure) 固定（默认为 5000.0）的所有数据点。
同样使用 curve_fit，但这次用一个线性函数 (Linear Model) y = ax + b 来拟合噪声标准差 (y) 与增益 (x) 之间的关系。
计算 R² 值。
生成另一张图表，展示实际数据点和拟合的直线。
结果保存：

所有分析图表（包括拟合曲线、方程和 R² 值）都会自动保存到 denoised_results 根目录下，文件名为 noise_vs_exposure_model_... 和 noise_vs_gain_model_...。
如何运行和解读结果
安装依赖：确保已安装 scipy 和 scikit-learn。
运行脚本：像之前一样直接运行 noise_analysis.py。脚本会先执行原始的去噪和噪声统计，然后自动开始执行新的建模分析部分。
查看结果：
脚本运行完毕后，在 denoised_results 文件夹中找到新生成的两张 .png 图。
噪声-曝光关系图：查看二次曲线是否能很好地穿过数据点。如果 R² 值很高（例如 > 0.95），说明噪声随曝光的增长关系可以用一个二次函数很好地描述。
噪声-增益关系图：查看直线是否能很好地拟合数据点。如果 R² 值很高，说明在固定曝光下，噪声与增益大致成线性关系。
这样，您就得到了关于噪声和关键参数（曝光、增益）之间关系的可量化模型，并且有图表和 R² 值来支撑您的结论。


为什么gain使用线性拟合？ 而exposure使用二次模型？ 这是有什么依据吗？

理论依据： 在图像传感器中，增益（Gain）本质上是一个放大器。它将光电二极管收集到的电荷（即图像信号）进行线性放大，然后再送入ADC（模数转换器）。

信号与噪声的同步放大：这个放大过程不仅放大了我们想要的图像信号，也同等比例地放大了在此之前产生的所有噪声，主要是光子散粒噪声（Photon Shot Noise）和暗电流噪声（Dark Current Noise）。
线性关系：假设在增益放大前，总的噪声标准差是 σ_pre_gain。经过一个放大倍数为 G 的线性放大器后，输出的噪声标准差理论上会变为 σ_post_gain = G * σ_pre_gain。
因此，当我们固定曝光时间（即 σ_pre_gain 是一个定值）时，最终测得的噪声标准差 σ_total 与增益 G 之间应该呈现一个线性关系。这就是我们选择 y = ax + b 模型来拟合它的根本原因。

为什么曝光（Exposure）的关系更适合用二次模型？
这比增益要复杂一些，因为它涉及到多种噪声源的叠加。

理论依据： 主要的噪声源与曝光时间 E 的关系如下：

光子散粒噪声 (Photon Shot Noise)：这是由光子到达传感器的随机性引起的，是光信号本身固有的一种噪声。根据泊松分布理论，这种噪声的方差 (variance, σ²) 与信号强度（即光子数量）成正比。而信号强度又与曝光时间 E 成正比。

σ²_shot ∝ E
所以，标准差 σ_shot ∝ sqrt(E)。
暗电流噪声 (Dark Current Noise)：即使在没有光的情况下，传感器由于热运动也会产生一些电子，形成暗电流。这种噪声的产生也符合泊松分布，其方差与曝光时间 E 成正比。

σ²_dark ∝ E
所以，标准差 σ_dark ∝ sqrt(E)。
读取噪声 (Read Noise)：这是在读出电子信号过程中产生的噪声，它与曝光时间 E 无关，是一个固定值。

σ²_read = Constant







噪声建模时，一般和增益是线性关系，还是二次关系？
没有单一的"线性"或"二次"关系，实际关系是：

在低光照/高增益时：更接近线性（读取噪声主导）

在高光照/低增益时：更接近平方根关系（散粒噪声主导）